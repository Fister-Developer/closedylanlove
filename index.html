<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Добро пожаловать домой</title>
  <!-- Подключите шрифты по желанию. Сейчас используется Poppins + Playfair Display -->
  <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;600;700&family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">
  <!-- Favicon: замените на ваш фавикон, если нужно -->
  <link rel="icon" href="data:;base64,iVBORw0KGgo=" />

  <style>
    :root{
      --bg-1: #170021; /* глубокий фиолет */
      --bg-2: #2a0011; /* кровавый отлив */
      --accent: #d73b5c; /* яркая кровь */
      --muted: #b8a5c8;
      --glass: rgba(255,255,255,0.04);
      --card: rgba(255,255,255,0.03);
      --glass-2: rgba(0,0,0,0.4);
      --radius: 14px;
    }

    *{box-sizing:border-box}
    html,body{height:100%;}
    body{
      margin:0;
      font-family:Poppins,system-ui,-apple-system,"Segoe UI",Roboto,Arial;
      background:linear-gradient(160deg,var(--bg-1) 0%, #190018 30%, var(--bg-2) 100%);
      color: #f6eef8;
      -webkit-font-smoothing:antialiased;
      -moz-osx-font-smoothing:grayscale;
      display:flex;
      align-items:center;
      justify-content:center;
      padding:28px;
    }

    /* Subtle noise overlay */
    body:before{content:"";position:fixed;inset:0;background-image:url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="200" height="200" viewBox="0 0 4 4"><rect width="4" height="4" fill="%23000000" fill-opacity="0.02"/></svg>');pointer-events:none}

    .app{
      width:100%;
      max-width:1100px;
      min-height:640px;
      background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
      border-radius:20px;
      padding:22px;
      box-shadow:0 10px 40px rgba(0,0,0,0.6);
      position:relative;
      overflow:hidden;
    }

    header{
      display:flex;align-items:center;gap:16px;padding:6px 12px;margin-bottom:10px;
    }
    .logo{
      width:56px;height:56px;border-radius:12px;background:linear-gradient(135deg, rgba(255,255,255,0.03), rgba(255,255,255,0.01));display:flex;align-items:center;justify-content:center;flex-shrink:0;border:1px solid rgba(255,255,255,0.04)
    }
    .logo svg{width:34px;height:34px}
    .title{font-family:'Playfair Display',serif;font-size:20px;line-height:1;color:#fff}
    .subtitle{font-size:12px;color:var(--muted)}

    main{padding:14px}

    /* Main menu cards */
    .grid{
      display:grid;grid-template-columns:repeat(2,1fr);gap:14px;margin-top:18px
    }
    .card{
      background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
      border-radius:var(--radius);
      padding:18px;display:flex;align-items:center;gap:14px;border:1px solid rgba(255,255,255,0.03);cursor:pointer;transition:transform .28s ease,box-shadow .28s ease;
    }
    .card:hover{transform:translateY(-6px);box-shadow:0 12px 30px rgba(0,0,0,0.6)}
    .card .ico{width:56px;height:56px;border-radius:12px;background:linear-gradient(135deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));display:flex;align-items:center;justify-content:center;border:1px solid rgba(255,255,255,0.03)}
    .card h3{margin:0;font-size:16px}
    .card p{margin:0;font-size:12px;color:var(--muted)}

    /* Sections container */
    .section{display:none;padding:10px;margin-top:8px}
    .section.active{display:block}

    /* Album grid */
    .album-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:12px}
    .photo{
      background:var(--card);height:160px;border-radius:12px;display:flex;align-items:end;justify-content:center;padding:10px;position:relative;overflow:hidden;border:1px solid rgba(255,255,255,0.02)
    }
    .photo img{width:100%;height:100%;object-fit:cover;border-radius:12px;transition:transform .35s ease}
    .photo:hover img{transform:scale(1.06)}
    .caption{
      position:absolute;left:10px;bottom:10px;background:linear-gradient(90deg,rgba(0,0,0,0.45),rgba(0,0,0,0.2));padding:8px 10px;border-radius:10px;font-size:12px
    }

    /* Modal */
    .modal{position:fixed;inset:0;background:linear-gradient(180deg, rgba(0,0,0,0.6), rgba(0,0,0,0.6));display:flex;align-items:center;justify-content:center;padding:20px;z-index:120}
    .modal .box{width:100%;max-width:880px;background:var(--glass-2);padding:18px;border-radius:16px;border:1px solid rgba(255,255,255,0.04)}
    .modal img{width:100%;border-radius:12px}
    .close-btn{display:inline-flex;gap:8px;align-items:center;background:transparent;border:1px solid rgba(255,255,255,0.06);padding:8px 12px;border-radius:10px;color:var(--muted);cursor:pointer}

    /* Story chat */
    .chat{display:flex;flex-direction:column;gap:12px;max-width:820px}
    .msg{max-width:72%;padding:12px 16px;border-radius:18px;position:relative;animation:pop .28s ease;}
    .msg .who{font-size:11px;color:var(--muted);margin-bottom:6px}
    .msg.danya{align-self:flex-end;background:linear-gradient(180deg, rgba(215,59,92,0.16), rgba(215,59,92,0.08));border:1px solid rgba(215,59,92,0.12)}
    .msg.dasha{align-self:flex-start;background:linear-gradient(180deg, rgba(120,70,160,0.08), rgba(120,70,160,0.04));border:1px solid rgba(255,255,255,0.03)}
    .typing{width:72px;height:36px;background:var(--card);border-radius:14px;display:flex;align-items:center;justify-content:center}
    .dots span{display:inline-block;width:7px;height:7px;border-radius:50%;background:var(--muted);margin:0 5px;opacity:.4;animation:blink 1s infinite}
    .dots span:nth-child(2){animation-delay:.15s}
    .dots span:nth-child(3){animation-delay:.3s}
    @keyframes blink{0%{opacity:.2}50%{opacity:1}100%{opacity:.2}}
    @keyframes pop{from{opacity:0;transform:translateY(6px)}to{opacity:1;transform:none}}

    /* Game chests */
    .chests{display:flex;gap:14px;align-items:flex-end;justify-content:center}
    .chest{width:150px;height:140px;background:linear-gradient(180deg,#2b0011,#3a0016);border-radius:12px;position:relative;padding-bottom:24px;border:1px solid rgba(255,255,255,0.04);cursor:pointer;display:flex;align-items:center;justify-content:center}
    .chest .lid{position:absolute;top:-22px;width:calc(100% - 16px);height:40px;background:linear-gradient(90deg,#450019,#7a0829);border-radius:10px 10px 6px 6px;left:8px;display:flex;align-items:center;justify-content:center}
    .chest .decor{font-size:22px}
    .prize{margin-top:12px;text-align:center;color:var(--muted);font-size:14px}

    /* Confetti */
    .confetti-piece{position:absolute;width:8px;height:12px;opacity:0;pointer-events:none}

    /* Music page */
    .music-grid{display:grid;grid-template-columns:repeat(2,1fr);gap:12px}
    .banner{height:120px;border-radius:12px;background:linear-gradient(90deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));display:flex;align-items:center;justify-content:space-between;padding:12px;border:1px solid rgba(255,255,255,0.03)}
    .banner .meta{display:flex;flex-direction:column;gap:6px}
    .banner img{width:110px;height:96px;object-fit:cover;border-radius:10px}

    /* Footer controls */
    .controls{display:flex;gap:8px;align-items:center;margin-top:18px}
    .btn{background:transparent;border:1px solid rgba(255,255,255,0.06);padding:10px 14px;border-radius:12px;cursor:pointer}

    /* Loader */
    #loader{position:fixed;inset:0;background:linear-gradient(180deg, rgba(15,2,10,0.95), rgba(20,1,6,0.95));display:flex;align-items:center;justify-content:center;z-index:9999}
    .loader-inner{display:flex;flex-direction:column;align-items:center;gap:18px}
    .loader-text{font-family:'Playfair Display',serif;font-size:26px;color:#fff}
    .heart-wrap{width:120px;height:120px}

    /* heart svg fill */
    .heart-fill{transform-origin:center bottom;transform:scaleY(0);transition:transform 1.8s cubic-bezier(.2,.9,.28,1)}
    .loader-sub{color:var(--muted);font-size:13px}

    /* Responsive */
    @media (max-width:900px){
      .album-grid{grid-template-columns:repeat(2,1fr)}
      .grid{grid-template-columns:1fr 1fr}
      .music-grid{grid-template-columns:1fr}
    }
    @media (max-width:600px){
      body{padding:12px}
      .app{padding:12px;border-radius:12px}
      .grid{grid-template-columns:1fr}
      .album-grid{grid-template-columns:1fr}
      header{gap:10px}
      .logo{width:44px;height:44px}
      .title{font-size:16px}
      .photo{height:220px}
    }
  </style>
</head>
<body>

  <div id="loader">
    <div class="loader-inner">
      <div class="heart-wrap" aria-hidden>
        <!-- SVG heart with clip-path — сердечко заполняется сверху вниз -->
        <svg viewBox="0 0 48 48" width="120" height="120" xmlns="http://www.w3.org/2000/svg">
          <defs>
            <path id="hpath" d="M24 42s-18-12.6-18-25.2C6 9.6 10.8 5 16.5 5 20 5 24 7.4 24 7.4S28 5 31.5 5C37.2 5 42 9.6 42 16.8 42 29.4 24 42 24 42z"/>
            <clipPath id="hclip"><use href="#hpath"/></clipPath>
          </defs>
          <rect x="0" y="0" width="48" height="48" fill="url(#g)" class="heart-fill" clip-path="url(#hclip)" style="transform-origin:center bottom;"/>
          <use href="#hpath" fill="none" stroke="rgba(255,255,255,0.28)" stroke-width="1.6" />
          <defs>
            <linearGradient id="g" x1="0" x2="1">
              <stop offset="0%" stop-color="#d73b5c"/>
              <stop offset="100%" stop-color="#8b0b3a"/>
            </linearGradient>
          </defs>
        </svg>
      </div>
      <div class="loader-text">Добро пожаловать домой!</div>
      <div class="loader-sub">загрузка — <span id="percent">0%</span></div>
      <button class="btn" id="skipBtn" style="margin-top:6px">Войти</button>
    </div>
  </div>

  <div class="app" role="application">
    <header>
      <div class="logo" aria-hidden>
        <!-- simple monogram icon -->
        <svg viewBox="0 0 100 100"><defs></defs>
          <rect x="6" y="6" width="88" height="88" rx="18" fill="rgba(255,255,255,0.02)"/>
          <text x="50" y="60" text-anchor="middle" font-family="Poppins" font-weight="700" font-size="36" fill="#fff">D&D</text>
        </svg>
      </div>
      <div>
        <div class="title">Даша и Даня</div>
        <div class="subtitle"></div>
      </div>
      <div style="margin-left:auto;display:flex;gap:8px;align-items:center">
        <button class="btn" id="themeToggle">❤</button>
      </div>
    </header>

    <main>
      <!-- main menu -->
      <div class="grid" id="mainMenu">
        <div class="card" data-target="album">
          <div class="ico">
            <!-- album icon -->
            <svg width="36" height="36" viewBox="0 0 24 24" fill="none" aria-hidden><path d="M3 5h18v14H3z" stroke="currentColor" stroke-width="1.2"/><circle cx="8.5" cy="9.5" r="1.8" fill="currentColor" /><path d="M21 19l-4-5-3 4-2-2-4 4" stroke="currentColor" stroke-width="1.2" fill="none"/></svg>
          </div>
          <div>
            <h3>Наш семейный альбом</h3>
            <p></p>
          </div>
        </div>

        <div class="card" data-target="story">
          <div class="ico">
            <svg width="36" height="36" viewBox="0 0 24 24" fill="none" aria-hidden><path d="M21 15v-7a2 2 0 0 0-2-2H8L3 7v8a2 2 0 0 0 2 2h12l4 4" stroke="currentColor" stroke-width="1.2" fill="none"/></svg>
          </div>
          <div>
            <h3>Наша история</h3>
            <p></p>
          </div>
        </div>

        <div class="card" data-target="game">
          <div class="ico">
            <svg width="36" height="36" viewBox="0 0 24 24" fill="none" aria-hidden><path d="M3 12h18M12 3v18M5 6v12M19 6v12" stroke="currentColor" stroke-width="1.2"/></svg>
          </div>
          <div>
            <h3>Наша игра</h3>
            <p></p>
          </div>
        </div>

        <div class="card" data-target="music">
          <div class="ico">
            <svg width="36" height="36" viewBox="0 0 24 24" fill="none" aria-hidden><path d="M9 17V5l12-2v12" stroke="currentColor" stroke-width="1.2"/><circle cx="6" cy="17" r="3" fill="currentColor"/></svg>
          </div>
          <div>
            <h3>Моя любовь для тебя в музыке</h3>
            <p></p>
          </div>
        </div>
      </div>

      <!-- Sections -->
      <section id="album" class="section">
        <div style="display:flex;justify-content:space-between;align-items:center;gap:12px">
          <h2 style="margin:0">Наш семейный альбом</h2>
          <div><button class="btn" data-action="back">← Назад</button></div>
        </div>
        <p style="color:var(--muted)">\ <code></code></p>
        <div class="album-grid" style="margin-top:12px">
          <!-- Примеры фотографий — замените data-src на ваши URL. -->
          <div class="photo" data-src="">
            <img src="foto 1.jpg" alt="Фото 1" />
            <div class="caption">Это мой поцелуй для тебя</div>
          </div>
          <div class="photo" data-src="">
            <img src="foto 2.jpg" alt="Фото 2" />
            <div class="caption">Это твой поцелуй для меня</div>
          </div>
          <div class="photo" data-src="">
            <img src="foto 3.jpg" alt="Фото 3" />
            <div class="caption">Тут я осознаю что у меня есть ты</div>
          </div>
          <div class="photo" data-src="">
            <img src="foto 4.jpg" alt="Фото 4" />
            <div class="caption">Это самая очаровательная принцесса</div>
          </div>
          <div class="photo" data-src="">
            <img src="foto 5.jpg" alt="Фото 5" />
            <div class="caption">А тут самые красивые глазки</div>
          </div>
          <div class="photo" data-src="">
            <img src="foto 6.jpg" alt="Фото 6" />
            <div class="caption">Семейное фото</div>
          </div>
        </div>
      </section>

      <section id="story" class="section">
        <div style="display:flex;justify-content:space-between;align-items:center;gap:12px">
          <h2 style="margin:0">Наша история</h2>
          <div><button class="btn" data-action="back">← Назад</button></div>
        </div>
        <p style="color:var(--muted)"></p>

        <div class="chat" id="chatArea" style="margin-top:16px">
          <!-- сообщения будут рендериться через JS -->
        </div>
      </section>

      <section id="game" class="section">
        <div style="display:flex;justify-content:space-between;align-items:center;gap:12px">
          <h2 style="margin:0">Наша игра — Сундучки</h2>
          <div><button class="btn" data-action="back">← Назад</button></div>
        </div>
        <p style="color:var(--muted)"></p>
        <div class="chests" id="chestRow" style="margin-top:18px">
          <div class="chest" data-index="0"><div class="lid">Сундук 1</div><div class="prize">Нажмите</div></div>
          <div class="chest" data-index="1"><div class="lid">Сундук 2</div><div class="prize">Нажмите</div></div>
          <div class="chest" data-index="2"><div class="lid">Сундук 3</div><div class="prize">Нажмите</div></div>
        </div>
        <div style="text-align:center;margin-top:14px"><button class="btn" id="reshuffle">Перемешать</button></div>
      </section>

      <section id="music" class="section">
        <div style="display:flex;justify-content:space-between;align-items:center;gap:12px">
          <h2 style="margin:0">Моя любовь для тебя в музыке</h2>
          <div><button class="btn" data-action="back">← Назад</button></div>
        </div>
        <p style="color:var(--muted)"<code></code> </p>

        <div class="music-grid" style="margin-top:12px">
          <div class="banner">
            <div class="meta">
              <div style="font-weight:600">Любимая песня</div>
              <div style="font-size:13px;color:var(--muted)">Плейлист нашей любви</div>
              <!-- Замените data-src на прямую ссылку к аудиофайлу (mp3) -->
              <audio controls preload="none" data-src="799641.mp3">
                <source type="audio/mpeg">
                Ваш браузер не поддерживает аудио.
              </audio>
            </div>
            <img src="i (3).webp" alt="banner"/>
          </div>

          <div class="banner">
            <div class="meta">
              <div style="font-weight:600">Ночной трек</div>
              <div style="font-size:13px;color:var(--muted)">Теплые воспоминания</div>
              <audio controls preload="none" data-src="901246.mp3">
                <source type="audio/mpeg">
                Ваш браузер не поддерживает аудио.
              </audio>
            </div>
            <img src="banner.jpg" alt="banner"/>
          </div>
        </div>
      </section>

    </main>

    <!-- modal template -->
    <div id="modalRoot" style="display:none"></div>

  </div>

  <script>
    // ================= Loader ==================
    const loader = document.getElementById('loader');
    const percentEl = document.getElementById('percent');
    const heartFill = document.querySelector('.heart-fill');
    const skipBtn = document.getElementById('skipBtn');
    let pct = 0;
    const inc = () => {
      pct += Math.floor(Math.random()*8)+6;
      if(pct>100) pct=100;
      percentEl.textContent = pct+"%";
      heartFill.style.transform = 'scaleY('+ (pct/100) +')';
      if(pct<100) setTimeout(inc, 160 + Math.random()*260);
      else setTimeout(()=>hideLoader(), 600);
    }
    function hideLoader(){
      loader.style.transition='opacity .4s ease';
      loader.style.opacity='0';
      setTimeout(()=>loader.remove(),450);
      // show main app (no change needed because app is visible but loader covered it)
    }
    skipBtn.addEventListener('click', ()=>{ pct=100; percentEl.textContent='100%'; heartFill.style.transform='scaleY(1)'; setTimeout(hideLoader,200); });
    setTimeout(inc,600);

    // ================= Navigation ==================
    const cards = document.querySelectorAll('.card[data-target]');
    const sections = document.querySelectorAll('.section');
    function showSection(id){
      document.getElementById('mainMenu').style.display = id ? 'none' : 'grid';
      sections.forEach(s=>s.classList.remove('active'));
      if(id){
        const sec = document.getElementById(id);
        if(sec) sec.classList.add('active');
      }
    }
    cards.forEach(c=>c.addEventListener('click',()=>{ showSection(c.dataset.target); if(c.dataset.target==='story'){startChat()} }));
    document.querySelectorAll('[data-action="back"]').forEach(b=>b.addEventListener('click',()=>{ showSection(); }))

    // ================= Album modal ==================
    const modalRoot = document.getElementById('modalRoot');
    document.querySelectorAll('.photo').forEach(photo=>{
      photo.addEventListener('click',()=>{
        const src = photo.getAttribute('data-src') || photo.querySelector('img').src;
        const caption = photo.querySelector('.caption')?.textContent || '';
        modalRoot.innerHTML = `<div class="modal"><div class="box"><button class="close-btn" id="closeModal">← Закрыть</button><div style=\"margin-top:12px\"><img src=\"${src}\" alt=\"${caption}\"></div><p style=\"color:var(--muted);margin-top:8px\">${caption}</p></div></div>`;
        modalRoot.style.display = 'block';
        document.getElementById('closeModal').addEventListener('click', ()=>{ modalRoot.style.display='none'; modalRoot.innerHTML=''; });
      })
    })

    // ================= Story chat ==================
    const chatArea = document.getElementById('chatArea');
    const messages = [
      {who:'Даня', cls:'danya', text:'Привет)'} ,
      {who:'Даша', cls:'dasha', text:'Привет))'} ,
      {who:'Даня', cls:'danya', text:'Как твои дела?'},
      {who:'Даша', cls:'dasha', text:'Все хорошо, у тебя как дела?'},
      {who:'Даня', cls:'danya', text:'Да у меня тоже все хорошо, чем занимаешься?'},
      {who:'Даша', cls:'dasha', text:'Да ничем, только освободилась'},
      {who:'Даня', cls:'danya', text:'Понял, слушай у меня просьба к тебе. Не могла ли бы ты мне предоставить список членов семьи.'},
      {who:'Даша', cls:'dasha', text:'Слушай, да могу, но чуть позже'},
      {who:'Даня', cls:'danya', text:'Хорошо, буду ждать.'},
      {who:'system', cls:'', text:'Day moments later...'},
      {who:'Даня', cls:'danya', text:'Ну что там?'},
      {who:'Даша', cls:'dasha', text:'Блин, я забыла'},
      {who:'Даня', cls:'danya', text:'Да я уже сам всё сделал'},
      {who:'Даша', cls:'dasha', text:'Прости, правда замоталась.'},
      {who:'system', cls:'', text:'Week moment later...'},
      {who:'Даня', cls:'danya', text:'У меня для тебя кое что заготовлено'},
      {who:'Даша', cls:'dasha', text:'Ого, а что там?'},
      {who:'Даня', cls:'danya', text:'Ну перейди по ссылке'},
      {who:'Даша', cls:'dasha', text:'Да я согласно'},
      {who:'system', cls:'', text:'Даня предоставил Даше небольшой мини квест в виде WEB APP где было сделано предложение для вступления в отношения. На что она согласилась. Сегодня уже 13 сентября и они вместе. Совсем скоро ожидается близость, совместная жизнь!!!'}
    ];

    let chatIndex = 0;
    function startChat(){
      chatArea.innerHTML = '';
      chatIndex = 0;
      showNext();
    }
    function showNext(){
      if(chatIndex>=messages.length) return;
      const msg = messages[chatIndex];
      // if it's a system note, show centered small
      if(msg.who==='system'){
        const el = document.createElement('div');
        el.style.textAlign='center';el.style.color='var(--muted)';el.style.margin='8px 0';el.textContent=msg.text;
        chatArea.appendChild(el);
        chatIndex++; setTimeout(showNext,900);
        return;
      }
      // show typing bubble then message
      const typing = document.createElement('div');typing.className='typing';
      const dots = document.createElement('div');dots.className='dots';dots.innerHTML='<span></span><span></span><span></span>';
      typing.appendChild(dots);
      const wrapper = document.createElement('div');wrapper.style.display='flex';wrapper.style.justifyContent = (msg.cls==='danya'?'flex-end':'flex-start');wrapper.appendChild(typing);
      chatArea.appendChild(wrapper);
      chatArea.scrollTop = chatArea.scrollHeight;
      // simulate typing delay based on message length
      const delay = Math.min(1800, 400 + msg.text.length*40);
      setTimeout(()=>{
        wrapper.remove();
        const bubble = document.createElement('div');bubble.className='msg '+msg.cls;
        bubble.innerHTML = `<div class="who">${msg.who}</div><div class="text">${msg.text}</div>`;
        chatArea.appendChild(bubble);
        chatArea.scrollTop = chatArea.scrollHeight;
        chatIndex++; setTimeout(showNext, 600);
      }, delay);
    }

    // ================= Game logic ==================
    const phrases = [
      'Я люблю тебя очень сильно.',
      'Я хочу чтобы ты стала моей женой.',
      'Я хочу чтобы ты родила наше маленькое счастье.',
      'Я хочу чтобы мы с тобою дожили до бриллиантовой годовщины.',
      'Я хочу чтобы мы всегда были одним целым.'
    ];

    let assigned = [];
    const chests = document.querySelectorAll('.chest');
    function shufflePhrases(){
      // assign a random phrase to each chest (can repeat)
      assigned = chests && Array.from({length:chests.length}).map(()=>phrases[Math.floor(Math.random()*phrases.length)]);
      chests.forEach((c,i)=>{ c.querySelector('.prize').textContent = 'Нажмите'; c.classList.remove('opened'); });
    }
    chests.forEach(c=>{
      c.addEventListener('click', ()=>{
        const i = Number(c.dataset.index||0);
        if(c.classList.contains('opened')) return;
        c.classList.add('opened');
        // animate lid (simple scale)
        c.querySelector('.lid').style.transform='translateY(-12px) rotate(-6deg)';
        const prizeText = assigned[i] || phrases[ Math.floor(Math.random()*phrases.length) ];
        c.querySelector('.prize').textContent = prizeText;
        // spawn confetti
        spawnConfetti(c);
      })
    })
    document.getElementById('reshuffle').addEventListener('click', ()=>{ shufflePhrases(); });
    shufflePhrases();

    function spawnConfetti(container){
      for(let i=0;i<18;i++){
        const piece = document.createElement('div');
        piece.className='confetti-piece';
        piece.style.background = ['#ffd700','#ff6b6b','#8b0b3a','#c78bff','#ffdfe6'][Math.floor(Math.random()*5)];
        piece.style.left = (20 + Math.random()*60)+'%';
        piece.style.top = (10 + Math.random()*50)+'%';
        piece.style.transform = `translateY(-40px) rotate(${Math.random()*360}deg)`;
        container.appendChild(piece);
        // animate
        setTimeout(()=>{ piece.style.transition='all 900ms cubic-bezier(.2,.8,.2,1)'; piece.style.opacity=1; piece.style.transform = `translateY(${120 + Math.random()*120}px) rotate(${Math.random()*720}deg)`; }, 30+i*20);
        setTimeout(()=>piece.remove(), 1200 + Math.random()*400);
      }
    }

    // ================= Music: lazy load audio src from data-src ==================
    document.querySelectorAll('audio[data-src]').forEach(a=>{
      const src = a.getAttribute('data-src');
      if(src){
        a.querySelector('source').src = src;
        a.load();
      }
    });

    // small theme toggle (demo)
    document.getElementById('themeToggle').addEventListener('click', ()=>{
      document.documentElement.style.setProperty('--bg-1','#140013');
      document.documentElement.style.setProperty('--bg-2','#17000b');
      document.documentElement.style.setProperty('--accent','#ff6b88');
      // quick pulse
      document.querySelector('.app').animate([{transform:'scale(.996)'},{transform:'scale(1)'}],{duration:320});
    });

    // Accessibility: close modals with Escape
    document.addEventListener('keydown', e=>{ if(e.key==='Escape'){ const mod = document.querySelector('.modal'); if(mod) mod.remove(); modalRoot.style.display='none'; } });

    // On first reveal of story: auto-start when user navigates
    // (handled when clicking the Story card)

    // Ensure main menu visible if loader removed
    window.addEventListener('load', ()=>{
      // Nothing needed — loader hides automatically, but make sure app visible
    })

    // Note for user: replace placeholder image/audio links with your own content where data-src or img src are used.
  </script>

</body>
</html>



